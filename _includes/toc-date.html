{% capture site_url %}{{ site.url }}{{ site.baseurl }}{% endcapture %}
{% assign current_url = page.url | relative_url %}
<div class="book-summary" id="sidebar">
    <div id="book-search-input" role="search">
        <input type="text" placeholder="Tìm kiếm (Ctrl+K)" />
    </div>

    <div class="sidebar-header">
        <div class="sidebar-logo">
            <a href="https://help.tomoi.vn" class="logo-link">
                <img src="{{ site.baseurl }}/assets/images/logo.png" alt="TomOi Logo" class="sidebar-logo-img">
                <div class="sidebar-badge">Help</div>
            </a>
        </div>
    </div>
    <ul class="summary">
        <li class="header">Hướng dẫn sử dụng tài liệu</li>
        <li class="chapter{% if page.url == '/' %} active{% endif %}" data-path="{{ site.baseurl }}/">
            <a href="{{ site.baseurl }}/">
                <i class="fa fa-book" aria-hidden="true"></i> Hướng dẫn nhanh
            </a>
        </li>
        <li class="divider"></li>
        <li class="header">Giới thiệu</li>
        <li class="chapter{% if page.url == '/gioi-thieu/gioi-thieu-ve-tomoivn/' %} active{% endif %}">
            <a href="{{ site.baseurl }}/gioi-thieu/gioi-thieu-ve-tomoivn/">
                <i class="fa fa-info-circle" aria-hidden="true"></i> Giới thiệu về TomOi.vn
            </a>
        </li>
        <li class="chapter{% if page.url == '/gioi-thieu/ly-do-mua-hang/' %} active{% endif %}">
            <a href="{{ site.baseurl }}/gioi-thieu/ly-do-mua-hang/">
                <i class="fa fa-shopping-bag" aria-hidden="true"></i> Lý do nên mua hàng tại TomOi.vn
            </a>
        </li>
        <li class="chapter{% if page.url == '/gioi-thieu/nen-tang-chinh-thuc/' %} active{% endif %}">
            <a href="{{ site.baseurl }}/gioi-thieu/nen-tang-chinh-thuc/">
                <i class="fa fa-certificate" aria-hidden="true"></i> Các nền tảng chính thức
            </a>
        </li>
        <li class="chapter{% if page.url == '/gioi-thieu/tong-quan-website/' %} active{% endif %}">
            <a href="{{ site.baseurl }}/gioi-thieu/tong-quan-website/">
                <i class="fa fa-desktop" aria-hidden="true"></i> Tổng quan website
            </a>
        </li>
        <li class="chapter{% if page.url == '/gioi-thieu/dieu-khoan-dich-vu/' %} active{% endif %}">
            <a href="{{ site.baseurl }}/gioi-thieu/dieu-khoan-dich-vu/">
                <i class="fa fa-file-text-o" aria-hidden="true"></i> Điều khoản dịch vụ
            </a>
        </li>
        <li class="chapter{% if page.url == '/gioi-thieu/chinh-sach-bao-mat/' %} active{% endif %}">
            <a href="{{ site.baseurl }}/gioi-thieu/chinh-sach-bao-mat/">
                <i class="fa fa-shield" aria-hidden="true"></i> Chính sách bảo mật
            </a>
        </li>
        <li class="divider"></li>
        <li class="header">Hướng dẫn mua hàng</li>
        <li class="chapter{% if page.url == '/huong-dan-mua-hang/quan-ly-tai-khoan/' %} active{% endif %}">
            <a href="{{ site.baseurl }}/huong-dan-mua-hang/quan-ly-tai-khoan/">
                <i class="fa fa-user" aria-hidden="true"></i> Quản lý tài khoản
            </a>
        </li>
        <li class="chapter{% if page.url == '/huong-dan-mua-hang/tim-kiem-san-pham/' %} active{% endif %}">
            <a href="{{ site.baseurl }}/huong-dan-mua-hang/tim-kiem-san-pham/">
                <i class="fa fa-search" aria-hidden="true"></i> Tìm kiếm sản phẩm
            </a>
        </li>
        <li class="chapter{% if page.url == '/huong-dan-mua-hang/gio-hang-va-thanh-toan/' %} active{% endif %}">
            <a href="{{ site.baseurl }}/huong-dan-mua-hang/gio-hang-va-thanh-toan/">
                <i class="fa fa-shopping-cart" aria-hidden="true"></i> Giỏ hàng và thanh toán
            </a>
        </li>
        <li class="chapter{% if page.url == '/huong-dan-mua-hang/theo-doi-don-hang/' %} active{% endif %}">
            <a href="{{ site.baseurl }}/huong-dan-mua-hang/theo-doi-don-hang/">
                <i class="fa fa-truck" aria-hidden="true"></i> Theo dõi đơn hàng
            </a>
        </li>
        <li class="divider"></li>
        <li class="header">Thông tin bổ sung</li>
        <li class="chapter{% if page.url == '/thong-tin-khac/cau-hoi-thuong-gap/' %} active{% endif %}">
            <a href="{{ site.baseurl }}/thong-tin-khac/cau-hoi-thuong-gap/">
                <i class="fa fa-question-circle" aria-hidden="true"></i> Câu hỏi thường gặp
            </a>
        </li>
        <li class="chapter{% if page.url == '/thong-tin-khac/lien-he-ho-tro/' %} active{% endif %}">
            <a href="{{ site.baseurl }}/thong-tin-khac/lien-he-ho-tro/">
                <i class="fa fa-headphones" aria-hidden="true"></i> Liên hệ & Hỗ trợ
            </a>
        </li>
        <li class="chapter{% if page.url == '/thong-tin-khac/thong-tin-phien-ban/' %} active{% endif %}">
            <a href="{{ site.baseurl }}/thong-tin-khac/thong-tin-phien-ban/">
                <i class="fa fa-history" aria-hidden="true"></i> Thông tin phiên bản
            </a>
        </li>
        <li class="divider"></li>
        <li class="header">Hướng dẫn cài đặt và sử dụng</li>
        <li class="chapter{% if page.url == '/huong-dan-cai-dat/' %} active{% endif %}">
            <a href="{{ site.baseurl }}/huong-dan-cai-dat/">
                <i class="fa fa-cog" aria-hidden="true"></i> Hướng dẫn cài đặt và sử dụng sản phẩm
                </a>
        </li>
    </ul>
</div>

<!-- Mobile Navigation Toggle -->
<div class="book-header-mobile">
    <button id="sidebar-toggle" class="sidebar-toggle">
        <i class="fa fa-bars"></i>
    </button>
    <div class="header-title">
        {% if page.title %}
            {{ page.title | escape }}
        {% else %}
            {{ site.title | escape }}
        {% endif %}
    </div>
</div>

<!-- Overlay for mobile -->
<div id="sidebar-overlay"></div>

<style>
    .sidebar-header {
        padding: 10px 15px;
        margin-bottom: 10px;
        background-color: #f5f5f5;
        border-bottom: 1px solid #e5e5e5;
    }
    
    .sidebar-logo {
        display: block;
    }
    
    .logo-link {
        display: flex;
        align-items: center;
        text-decoration: none !important;
    }
    
    .sidebar-logo-img {
        height: 40px;
        width: auto;
        margin-right: 10px;
    }
    
    .sidebar-badge {
        display: inline-block;
        padding: 3px 8px;
        font-size: 12px;
        font-weight: 600;
        line-height: 1;
        color: #fff;
        background-color: var(--primary-color);
        border-radius: 10px;
        cursor: default;
    }
    
    #sidebar-brand {
        padding: 15px 15px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid var(--border-color);
        margin-bottom: 10px;
    }
    
    #sidebar-brand .logo {
        display: flex;
        align-items: center;
        text-decoration: none;
    }
    
    #sidebar-brand .brand-logo {
        width: 30px;
        height: 30px;
        margin-right: 10px;
    }
    
    #sidebar-brand .brand-text {
        font-weight: 600;
        font-size: 16px;
        color: var(--primary-color);
    }
    
    .book-summary .summary li {
        margin-bottom: 2px;
    }
    
    .book-summary ul.summary li a i {
        margin-right: 8px;
        width: 16px;
        text-align: center;
        color: var(--text-light-color);
    }
    
    .book-summary ul.summary li.active > a i {
        color: var(--primary-color);
    }
    
    /* Mobile navigation styles */
    .book-header-mobile {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 50px;
        padding: 0 15px;
        background-color: var(--background-color);
        box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
        z-index: 10;
        align-items: center;
    }
    
    .header-title {
        font-weight: 600;
        font-size: 16px;
        color: var(--text-color);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        text-align: center;
        flex-grow: 1;
    }
    
    .sidebar-toggle {
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: var(--text-color);
        padding: 5px;
        display: none;
    }
    
    #sidebar-toggle {
        display: none;
        margin-right: 10px;
    }
    
    #sidebar-close {
        display: none;
    }
    
    #sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 15;
    }
    
    /* Make header tabs larger */
    .book-summary ul.summary li.header {
        padding: 10px 15px 5px;
        font-size: 1.1rem;
        font-weight: 600;
        text-transform: uppercase;
        color: var(--primary-color);
        letter-spacing: 0.5px;
    }
    
    /* Responsive styles for mobile */
    @media (max-width: 768px) {
        .book-header-mobile {
            display: flex;
        }
        
        .book-body {
            margin-top: 50px;
        }
        
        .book-summary {
            position: fixed;
            top: 0;
            bottom: 0;
            z-index: 20;
            width: 280px;
            left: -280px;
            transition: transform 0.3s ease;
        }
        
        .book-summary.open {
            transform: translateX(280px);
        }
        
        #sidebar-toggle, 
        #sidebar-close {
            display: block;
        }
        
        .book-summary {
            overflow-y: auto;
        }
    }
    
    /* Sub-menu styles */
    .book-summary ul.summary li.has-sub-menu > a:after {
        content: '\f105'; /* Font Awesome angle-right icon */
        font-family: 'FontAwesome';
        float: right;
        margin-right: 10px;
        transition: transform 0.3s ease;
    }
    
    .book-summary ul.summary li.has-sub-menu.active > a:after {
        transform: rotate(90deg);
    }
    
    .book-summary ul.summary li ul.sub-menu {
        list-style: none;
        padding-left: 20px;
        display: none;
    }
    
    .book-summary ul.summary li.active ul.sub-menu {
        display: block;
    }
    
    .book-summary ul.summary li.has-sub-menu > a {
        cursor: pointer;
    }
    
    .book-summary ul.summary li ul.sub-menu li a {
        padding: 6px 15px;
        font-size: 0.9em;
    }
</style>

<script>
// Add this script to handle mobile navigation and submenu toggling
document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebar-toggle');
    const sidebarClose = document.getElementById('sidebar-close');
    const overlay = document.getElementById('sidebar-overlay');
    
    function openSidebar() {
        sidebar.classList.add('open');
        overlay.style.display = 'block';
        document.body.style.overflow = 'hidden'; // Prevent body scrolling
    }
    
    function closeSidebar() {
        sidebar.classList.remove('open');
        overlay.style.display = 'none';
        document.body.style.overflow = ''; // Restore body scrolling
    }
    
    if(sidebarToggle) {
        sidebarToggle.addEventListener('click', function() {
            openSidebar();
        });
    }
    
    if(sidebarClose) {
        sidebarClose.addEventListener('click', function() {
            closeSidebar();
        });
    }
    
    if(overlay) {
        overlay.addEventListener('click', function() {
            closeSidebar();
        });
    }
    
    // Toggle submenu when parent items are clicked
    const subMenuParents = document.querySelectorAll('.has-sub-menu > a');
    subMenuParents.forEach(function(item) {
        item.addEventListener('click', function(e) {
            // Only prevent default if we're actually clicking the parent item, not a child
            if (e.target === item || item.contains(e.target)) {
                e.preventDefault();
                const parent = item.parentElement;
                parent.classList.toggle('active');
            }
        });
    });
    
    // Close sidebar when a menu item is clicked (on mobile)
    const menuItems = document.querySelectorAll('.summary li:not(.has-sub-menu) a');
    menuItems.forEach(function(item) {
        item.addEventListener('click', function() {
            if (window.innerWidth <= 768) {
                setTimeout(function() {
                    closeSidebar();
                }, 300); // Small delay to ensure the link is followed
            }
        });
    });
    
    // Handle window resize
    window.addEventListener('resize', function() {
        if (window.innerWidth > 768) {
            closeSidebar();
        }
    });
    
    // Auto-expand submenu if any child is active
    document.querySelectorAll('.has-sub-menu').forEach(function(menu) {
        if (menu.querySelector('.active')) {
            menu.classList.add('active');
        }
    });
});
</script>
